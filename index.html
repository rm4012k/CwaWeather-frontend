<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ£ é›»å­é›å¤©æ°£ - æ¡ƒåœ’ (æœ€çµ‚ç‰ˆ) ğŸ£</title>
    <link rel="icon" type="image/png" href="./icon-v2.png">
    <link rel="apple-touch-icon" href="./icon-v2.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icon-v2.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap"
        rel="stylesheet">

    <style>
        /* ============================== */
        /* é›»å­é›é¢¨æ ¼è®Šæ•¸                 */
        /* ============================== */
        :root {
            --pet-shell: #FBE558;
            /* é®®äº®çš„é›»å­é›é»ƒè‰² */
            --pet-highlight: #FFFFA0;
            /* é«˜å…‰ */
            --pet-shadow: #D9C34C;
            /* é™°å½±/é‚Šç·£ */
            --pet-screen-bg: #C1EAC7;
            /* è¢å¹•èƒŒæ™¯è‰² (LCD ç¶ ) */
            --pet-screen-border: #808080;
            /* è¢å¹•é‚Šæ¡† */
            --pet-text-color: #3A3A3A;
            /* æ–‡å­—é¡è‰² */
            --pet-button: #E15554;
            /* æŒ‰éˆ•ç´…è‰² */
            --pet-keyring: #B0B0B0;
            /* é‘°åŒ™åœˆéŠ€è‰² */
            --pet-charm: #A2D2FF; /* åŠé£¾é¡è‰² (æ·ºè—è‰²) */
        }

        /* å…¨å±€è¨­ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Zen Maru Gothic', monospace, sans-serif;
            background-color: #ECECEC;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--pet-text-color);
            position: relative;
        }

        /* === é›»å­é›æœ¬é«”å®¹å™¨ (å°ºå¯¸åŠ å¤§) === */
        .pet-container {
            width: 400px;
            height: 520px;
            background: var(--pet-shell);
            border: 5px solid var(--pet-shadow);
            border-radius: 50% 50% 55% 55% / 60% 60% 40% 40%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), inset 0 5px 10px var(--pet-highlight);
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* é‘°åŒ™åœˆç’°èˆ‡åŠé£¾çµæ§‹ */
        .keyring-holder {
            width: 60px;
            height: 30px;
            background: var(--pet-shadow);
            border-radius: 50% / 100% 100% 0 0;
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            border: 3px solid var(--pet-shadow);
            border-bottom: none;
            z-index: 10;
        }

        .keyring {
            width: 35px;
            height: 35px;
            border: 5px solid var(--pet-keyring);
            border-radius: 50%;
            position: absolute;
            top: -65px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9;
        }
        
        .keyring-chain {
            height: 10px;
            width: 2px;
            background: var(--pet-keyring);
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 8;
        }
        
        .keyring-charm {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 8;
            width: 40px;
            height: 40px;
            background: var(--pet-charm);
            border-radius: 50%;
            border: 3px solid var(--pet-shadow);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
        }

        /* === é¡¯ç¤ºè¢å¹• (å°ºå¯¸åŠ å¤§) === */
        .pet-screen {
            width: 300px;
            height: 240px;
            background: var(--pet-screen-bg);
            border: 6px solid var(--pet-screen-border);
            border-radius: 20px;
            margin-top: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
            padding: 10px;
        }

        /* === ç‹€æ…‹åˆ— (å›æ­¸è¢å¹•å…§) === */
        .pet-screen-status {
            width: 90%;
            display: flex;
            justify-content: space-between;
            position: absolute;
            top: 5px; /* é è¿‘è¢å¹•é ‚éƒ¨ */
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--pet-text-color);
            z-index: 10; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        }
        
        /* è¢å¹•å…§å®¹ */
        .screen-content {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            font-size: 1.2rem;
            line-height: 1.3;
            transition: opacity 0.3s ease;
            padding-top: 20px; /* å¢åŠ é ‚éƒ¨é–“è·ï¼Œé¿é–‹ç‹€æ…‹åˆ— */
        }
        
        /* é»é™£é¢¨æ ¼æ¨¡æ“¬ */
        .pet-temp, .pet-icon, .pet-line, .pet-fortune {
            font-family: 'Zen Maru Gothic', monospace, sans-serif;
            font-weight: 900;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.1);
        }

        .pet-icon {
            font-size: 3.5rem;
            margin-bottom: 10px;
            animation: gentleBob 2s infinite alternate;
        }
        
        @keyframes gentleBob {
             0%, 100% { transform: translateY(0); }
             50% { transform: translateY(-3px); }
        }

        .pet-temp {
            font-size: 4rem;
            line-height: 1;
        }
        
        .pet-line {
            font-size: 1.2rem;
            white-space: normal;
            word-break: break-word;
            max-width: 90%; 
            margin-top: 5px;
        }
        
        /* é‹å‹¢é é¢æ¨£å¼ */
        .pet-fortune {
            font-size: 1.4rem;
            max-width: 85%;
            margin-bottom: 10px;
        }
        .pet-color-box {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 5px;
            border: 2px solid var(--pet-text-color);
            margin-left: 10px;
            vertical-align: middle;
        }


        /* éš±è—çš„é é¢ */
        .screen-page {
            display: none;
        }
        
        .screen-page.active {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
        }
        
        /* === æŒ‰éˆ•å€ (å››å€‹æŒ‰éˆ•) === */
        .pet-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            width: 90%;
            margin-top: 30px;
        }

        /* æŒ‰éˆ•æ¨£å¼ (é‡é»ç¢ºèªï¼Œç¢ºä¿ 3D ç«‹é«”æ„Ÿ) */
        .pet-button {
            width: 65px;
            height: 65px;
            background: var(--pet-button);
            border-radius: 50%;
            border: 4px solid var(--pet-shadow); /* é‚Šæ¡† */
            box-shadow: 0 5px 0 var(--pet-shadow); /* é™°å½±è£½é€  3D æ•ˆæœ */
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: 900;
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.1s ease;
            user-select: none;
            position: relative;
        }

        .pet-button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 var(--pet-shadow); /* æŒ‰ä¸‹æ™‚é™°å½±è®Šå° */
        }
        
        .pet-button span {
            position: absolute;
            bottom: -25px;
            font-size: 0.8rem;
            color: var(--pet-text-color);
            white-space: nowrap;
        }

        /* Loading ç•«é¢ (ç¶­æŒä¸è®Š) */
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--pet-shell);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }
    </style>
</head>

<body>
    <div id="loading">
        <div class="loader-icon">ğŸ¥š</div>
        <p>æ­£åœ¨å­µåŒ–å¤©æ°£èˆ‡é‹å‹¢...</p>
    </div>

    <div class="pet-container" id="mainContent" style="display: none;">
        <div class="keyring-holder">
             <div class="keyring-chain"></div>
             <div class="keyring-charm">â¤ï¸</div>
        </div>
        <div class="keyring"></div>
        
        <div class="pet-screen">
            <div class="pet-screen-status">
                <span class="location">ğŸ“ æ¡ƒåœ’</span>
                <span class="datetime" id="petDateTime"></span>
            </div>
            
            <div class="screen-content" id="screenContainer">
                </div>
        </div>

        <div class="pet-buttons">
            <div class="pet-button" id="btnA">A<span>æº«åº¦</span></div>
            <div class="pet-button" id="btnB">B<span>å»ºè­°</span></div>
            <div class="pet-button" id="btnC">C<span>é å ±</span></div>
            <div class="pet-button" id="btnD">D<span>é‹å‹¢</span></div>
        </div>
    </div>

    <script>
        const API_URL = "https://weather-p.zeabur.app/api/weather/kaohsiung";
        let weatherData = null;
        let currentPage = 0; 
        const MAX_PAGES = 4;
        
        // é¡è‰²ä»£ç¢¼åˆ°ä¸­æ–‡åç¨±çš„æ˜ å°„
        const COLOR_MAP = {
            "#4CAF50": "ç¶ è‰²",
            "#FFEB3B": "é»ƒè‰²",
            "#9C27B0": "ç´«è‰²",
            "#F44336": "ç´…è‰²",
            "#2196F3": "è—è‰²",
            "#FF9800": "æ©˜è‰²"
        };
        
        // é‹å‹¢æ•¸æ“šåº«
        const FORTUNES = [
            {
                msg: "ä»Šå¤©é©åˆè¡åˆºï¼ä¸Šç­/ä¸Šå­¸é›»åŠ›æ»¿æ ¼ï¼Œæ‰€æœ‰å›°é›£éƒ½èƒ½è¿åˆƒè€Œè§£ã€‚",
                color: "#4CAF50" 
            },
            {
                msg: "ä¿æŒå¾®ç¬‘ï¼Œå¥½é‹å°±æœƒè‡ªå‹•æ‰¾ä¸Šé–€ã€‚è¨˜å¾—å¤šå’ŒåŒäº‹/åŒå­¸äº¤æµï¼",
                color: "#FFEB3B" 
            },
            {
                msg: "ä»Šå¤©éœ€è¦è€å¿ƒã€‚äº‹æƒ…å¤šåŠæœƒåœ¨åˆå¾Œé †åˆ©ï¼Œæ—©ä¸Šåˆ¥å¤ªæ€¥èºã€‚",
                color: "#9C27B0" 
            },
            {
                msg: "å¹¸é‹è‰²æ˜¯ç†±æƒ…ç´…ï¼é©åˆå±•ç¾è‡ªæˆ‘ï¼Œå‹‡æ•¢è¡¨é”æƒ³æ³•ã€‚",
                color: "#F44336" 
            },
            {
                msg: "å·¥ä½œ/èª²æ¥­é‹å‹¢å¹³ç©©ã€‚ä¸å¦¨åˆ©ç”¨åˆä¼‘æ™‚é–“è¦åŠƒä¸‹ä¸€æ­¥ï¼Œè¿æ¥æŒ‘æˆ°ã€‚",
                color: "#2196F3" 
            },
            {
                msg: "å¤šåˆ©ç”¨ä¼‘æ¯æ™‚é–“æ”¾é¬†ã€‚æ•ˆç‡ä¸æ˜¯ä¸€åˆ‡ï¼Œé©åº¦çš„ä¼‘æ¯æ‰èƒ½èµ°å¾—æ›´é ã€‚",
                color: "#FF9800" 
            }
        ];
        
        // éš¨æ©Ÿé¸å–é‹å‹¢
        function getRandomFortune() {
            const index = Math.floor(Math.random() * FORTUNES.length);
            return FORTUNES[index];
        }

        function getWeatherIcon(weather) {
            if (!weather) return "â“";
            if (weather.includes("æ™´")) return "ğŸŒ";
            if (weather.includes("å¤šé›²")) return "ğŸŒ¥ï¸";
            if (weather.includes("é™°")) return "â˜ï¸";
            if (weather.includes("é›¨")) return "ğŸ’§";
            if (weather.includes("é›·")) return "âš¡";
            return "ğŸ£";
        }

        function getAdvice(rainProb, maxTemp) {
            let rainIcon = "ğŸ‘";
            let rainText = "ä¸ç”¨å¸¶å‚˜ï¼Œå‡ºé–€å§ï¼";
            if (parseInt(rainProb) > 30) {
                rainIcon = "â˜”";
                rainText = "å¸¶å‚˜ï¼Œé˜²ç¯„æ–¼æœªç„¶ï¼";
            } else if (parseInt(rainProb) > 60) {
                rainIcon = "âš ï¸";
                rainText = "å¤§é›¨ï¼Œè«‹æ³¨æ„å®‰å…¨ï¼";
            }

            let clothIcon = "ğŸ‘•";
            let clothText = "èˆ’é©çš„ç©¿æ­æœ€é‡è¦ï¼";
            if (parseInt(maxTemp) >= 28) {
                clothIcon = "ğŸ¥µ";
                clothText = "çŸ­è¢–ï¼Œå°å¿ƒæ›¬å‚·ï¼";
            } else if (parseInt(maxTemp) <= 20) {
                clothIcon = "ğŸ¥¶";
                clothText = "åŠ ä»¶å¤–å¥—æ‰ä¸æœƒæ„Ÿå†’ï¼";
            }

            return { rainIcon, rainText, clothIcon, clothText };
        }

        function getTimeDisplay(startTime) {
            const date = new Date(startTime);
            const hour = date.getHours();
            if (hour >= 5 && hour < 11) return "æ—©æ™¨";
            if (hour >= 11 && hour < 14) return "ä¸­åˆ";
            if (hour >= 14 && hour < 18) return "ä¸‹åˆ";
            if (hour >= 18 && hour < 23) return "æ™šä¸Š";
            return "æ·±å¤œ";
        }
        
        function getPetDateTime() {
            const now = new Date();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const hour = String(now.getHours()).padStart(2, '0');
            const minute = String(now.getMinutes()).padStart(2, '0');
            return `${month}/${date} ${hour}:${minute}`;
        }

        /* --- é é¢æ¸²æŸ“é‚è¼¯ --- */

        function renderTemperaturePage(current) {
            const avgTemp = Math.round((parseInt(current.maxTemp) + parseInt(current.minTemp)) / 2);
            return `
                <div class="screen-page active" id="page-0">
                    <div class="pet-icon">${getWeatherIcon(current.weather)}</div>
                    <div class="pet-temp">${avgTemp}Â°C</div>
                    <div class="pet-line">${current.weather}</div> 
                    <div class="pet-subtitle">Min ${current.minTemp}Â° Max ${current.maxTemp}Â°</div>
                </div>
            `;
        }

        function renderAdvicePage(current) {
            const advice = getAdvice(current.rain, current.maxTemp);
            return `
                <div class="screen-page active" id="page-1" style="display:flex; flex-direction:column; justify-content:space-around; padding: 10px 0;">
                    <div class="pet-line" style="font-size: 1.3rem;">ç©¿æ­å»ºè­°</div>
                    <div class="advice-item-screen" style="align-items: center;">
                        <div class="pet-icon" style="font-size:2.5rem; margin:0;">${advice.clothIcon}</div>
                        <div class="pet-line" style="font-size:1.1rem; text-align: left; width: 70%;">${advice.clothText}</div>
                    </div>
                    <div class="pet-line" style="font-size: 1.3rem;">é™é›¨æ©Ÿç‡ ${current.rain}%</div>
                    <div class="advice-item-screen" style="align-items: center;">
                        <div class="pet-icon" style="font-size:2.5rem; margin:0;">${advice.rainIcon}</div>
                        <div class="pet-line" style="font-size:1.1rem; text-align: left; width: 70%;">${advice.rainText}</div>
                    </div>
                </div>
            `;
        }

        function renderForecastPage(others) {
            const listItems = others.slice(0, 4).map(f => {
                const time = getTimeDisplay(f.startTime);
                return `
                    <div class="forecast-item">
                        <span class="forecast-time">${time} ${getWeatherIcon(f.weather)}</span>
                        <span class="forecast-temp">${f.minTemp}Â°~${f.maxTemp}Â°</span>
                        <span class="forecast-rain">ğŸ’§${f.rain}%</span>
                    </div>
                `;
            }).join('');

            return `
                <div class="screen-page active" id="page-2" style="padding-top:10px;">
                    <div class="pet-line" style="margin-bottom: 5px; font-size: 1.3rem;">æœªä¾†å››æ™‚é å ±</div>
                    <div class="forecast-list">
                        ${listItems}
                    </div>
                </div>
            `;
        }
        
        function renderFortunePage() {
            const fortune = getRandomFortune();
            const colorName = COLOR_MAP[fortune.color] || fortune.color;
            
            return `
                <div class="screen-page active" id="page-3" style="padding: 10px 0;">
                    <div class="pet-line" style="margin-bottom: 15px; font-size: 1.3rem; margin-top: 15px;">æ¯æ—¥é‹å‹¢ âœ¨</div>
                    <div class="pet-fortune">${fortune.msg}</div>
                    <div class="pet-line" style="margin-top: 15px;">
                        å¹¸é‹è‰²ï¼š
                        <span style="color: ${fortune.color}; font-weight: 900; font-size: 1.2rem;">${colorName}</span>
                        <span class="pet-color-box" style="background-color: ${fortune.color};"></span>
                    </div>
                </div>
            `;
        }

        function switchScreen(pageIndex) {
            const container = document.getElementById('screenContainer');
            if (!weatherData) return;

            const current = weatherData.forecasts[0];
            const others = weatherData.forecasts.slice(1);

            let newContent = '';

            switch (pageIndex % MAX_PAGES) {
                case 0:
                    newContent = renderTemperaturePage(current);
                    break;
                case 1:
                    newContent = renderAdvicePage(current);
                    break;
                case 2:
                    newContent = renderForecastPage(others);
                    break;
                case 3:
                    newContent = renderFortunePage();
                    break;
            }
            
            // æ›¿æ›å…§å®¹ä¸¦å¼·åˆ¶é‡ç¹ª
            container.style.opacity = 0;
            setTimeout(() => {
                container.innerHTML = newContent;
                container.style.opacity = 1;
            }, 100);

            currentPage = pageIndex % MAX_PAGES;
        }

        /* --- åˆå§‹åŒ–èˆ‡äº‹ä»¶ç¶å®š --- */

        function setupPetMachine() {
            // 1. è¨­ç½®æŒ‰éˆ•äº‹ä»¶
            document.getElementById('btnA').addEventListener('click', () => switchScreen(0));
            document.getElementById('btnB').addEventListener('click', () => switchScreen(1));
            document.getElementById('btnC').addEventListener('click', () => switchScreen(2));
            document.getElementById('btnD').addEventListener('click', () => switchScreen(3)); 
            
            // 2. è¨­ç½®å®šæ™‚æ™‚é˜æ›´æ–°
            const dateTimeElement = document.getElementById('petDateTime');
            function updateDateTime() {
                dateTimeElement.textContent = getPetDateTime();
            }
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // 3. åˆå§‹é¡¯ç¤º
            switchScreen(0);
        }

        async function fetchWeather() {
            try {
                // æ¨¡æ“¬å­µåŒ–æ™‚é–“
                const delayPromise = new Promise(resolve => setTimeout(resolve, 1500));
                const fetchPromise = fetch(API_URL).then(res => res.json());

                const [_, json] = await Promise.all([delayPromise, fetchPromise]);

                if (json.success) {
                    weatherData = json.data;
                    
                    // è³‡æ–™è¼‰å…¥å®Œæˆå¾Œï¼Œåˆå§‹åŒ–é›»å­é›
                    setupPetMachine();

                    // éš±è— Loadingï¼Œé¡¯ç¤ºä¸»ç•«é¢
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('mainContent').style.display = 'flex';
                } else {
                    throw new Error("API Error");
                }
            } catch (e) {
                console.error(e);
                alert("é›»å­é›å­µåŒ–å¤±æ•—ï¼Œå¤©æ°£è³‡æ–™è®€å–ä¸­æ–·ï¼");
            }
        }

        document.addEventListener("DOMContentLoaded", fetchWeather);
    </script>
</body>

</html>